{% comment %}
  Luma Labs AI Skin Quiz
  Based on mockup: 6: Skincare Quiz.html
  Sends JSON payload to Make.com webhook URL (configurable in theme editor)
{% endcomment %}

{%- assign webhook_url = section.settings.webhook_url -%}
{%- assign store_domain = shop.domain -%}

<style>
  .lsq-body {
    min-height: 100vh;
    background-color: #fafafa;
    color: #1a1a1a;
    -webkit-font-smoothing: antialiased;
    display: flex;
    flex-direction: column;
  }

  /* Header */
  .lsq-header {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    z-index: 50;
    padding: 20px 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #e5e5e5;
    background: rgba(255, 255, 255, 0.85);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    box-sizing: border-box;
  }

  .lsq-logo {
    font-family: 'Playfair Display', Georgia, serif;
    font-size: 22px;
    font-weight: 500;
    color: #1a1a1a;
    text-decoration: none;
    letter-spacing: -0.02em;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .lsq-logo-icon {
    color: #d4a340;
    font-size: 18px;
  }
  .lsq-logo span {
    font-family: 'Inter', Arial, sans-serif;
    font-weight: 300;
    font-size: 18px;
    margin-top: 2px;
  }

  .lsq-exit {
    font-family: 'Inter', Arial, sans-serif;
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: rgba(26, 26, 26, 0.5);
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: color 0.3s;
  }
  .lsq-exit:hover {
    color: #1a1a1a;
  }

  /* Progress Bar */
  .lsq-progress-track {
    position: fixed;
    top: 73px;
    left: 0;
    width: 100%;
    height: 3px;
    background: #e5e5e5;
    z-index: 50;
  }
  .lsq-progress-fill {
    height: 100%;
    background: #1a1a1a;
    width: 16.6%;
    transition: width 0.5s ease;
  }

  /* Main Content */
  .lsq-main {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 120px 16px 64px;
  }

  /* Step Container */
  .lsq-step {
    width: 100%;
    max-width: 720px;
    margin: 0 auto;
    display: none;
    animation: lsqFadeIn 0.4s ease-out forwards;
  }
  .lsq-step.is-active {
    display: block;
  }

  @keyframes lsqFadeIn {
    from {
      opacity: 0;
      transform: translateY(12px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .lsq-step-header {
    text-align: center;
    margin-bottom: 40px;
  }

  .lsq-step-counter {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: rgba(229, 229, 229, 0.5);
    color: rgba(26, 26, 26, 0.6);
    font-family: 'Inter', Arial, sans-serif;
    font-size: 10px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    padding: 5px 14px;
    border-radius: 20px;
    margin-bottom: 20px;
  }

  .lsq-step-title {
    font-family: 'Playfair Display', Georgia, serif;
    font-size: clamp(28px, 5vw, 48px);
    color: #1a1a1a;
    margin: 0 0 16px;
    line-height: 1.15;
  }

  .lsq-lab-note {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    font-family: 'Inter', Arial, sans-serif;
    font-size: 12px;
    padding: 8px 16px;
    border-radius: 8px;
    margin-top: 8px;
  }
  .lsq-lab-note--blue {
    background: #eff6ff;
    border: 1px solid #bfdbfe;
    color: #1e40af;
  }
  .lsq-lab-note--red {
    background: #fef2f2;
    border: 1px solid #fecaca;
    color: #991b1b;
  }

  .lsq-step-sub {
    font-family: 'Inter', Arial, sans-serif;
    font-size: 14px;
    color: rgba(26, 26, 26, 0.6);
    max-width: 500px;
    margin: 0 auto;
  }

  /* Option Cards */
  .lsq-options {
    display: flex;
    flex-direction: column;
    gap: 14px;
  }

  .lsq-option {
    display: block;
    cursor: pointer;
  }
  .lsq-option input[type='radio'] {
    display: none;
  }

  .lsq-option-inner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 20px 24px;
    border-radius: 16px;
    border: 1px solid #e5e5e5;
    background: #ffffff;
    transition: border-color 0.3s, box-shadow 0.3s;
  }
  .lsq-option input:checked + .lsq-option-inner {
    border-color: #1a1a1a;
    background-color: #fafafa;
    box-shadow: 0 8px 24px -6px rgba(0, 0, 0, 0.06);
  }

  .lsq-option-left {
    display: flex;
    align-items: center;
    gap: 18px;
  }

  .lsq-option-icon {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: #f5f5f5;
    display: flex;
    align-items: center;
    justify-content: center;
    color: rgba(26, 26, 26, 0.5);
    font-size: 22px;
    flex-shrink: 0;
    transition: background 0.3s, color 0.3s;
  }
  .lsq-option input:checked + .lsq-option-inner .lsq-option-icon {
    background: #1a1a1a;
    color: #ffffff;
  }

  .lsq-option-title {
    font-family: 'Playfair Display', Georgia, serif;
    font-size: 18px;
    color: #1a1a1a;
    display: block;
    margin-bottom: 2px;
  }

  .lsq-option-sub {
    font-family: 'Inter', Arial, sans-serif;
    font-size: 12px;
    color: rgba(26, 26, 26, 0.55);
  }

  .lsq-check {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: #1a1a1a;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #ffffff;
    font-size: 13px;
    opacity: 0;
    transform: scale(0.5);
    transition: opacity 0.3s, transform 0.3s;
    flex-shrink: 0;
  }
  .lsq-option input:checked + .lsq-option-inner .lsq-check {
    opacity: 1;
    transform: scale(1);
  }

  /* Navigation */
  .lsq-nav {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 14px;
    margin-top: 44px;
  }

  .lsq-btn-back {
    width: 52px;
    height: 52px;
    border-radius: 50%;
    background: #ffffff;
    border: 1px solid #e5e5e5;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: background 0.3s;
    font-size: 18px;
    color: #1a1a1a;
  }
  .lsq-btn-back:hover {
    background: #f5f5f5;
  }

  .lsq-btn-next {
    font-family: 'Inter', Arial, sans-serif;
    font-size: 13px;
    font-weight: 600;
    padding: 16px 36px;
    border-radius: 50px;
    border: none;
    cursor: pointer;
    transition: all 0.3s;
  }
  .lsq-btn-next--disabled {
    background: #e5e5e5;
    color: rgba(26, 26, 26, 0.4);
    cursor: not-allowed;
  }
  .lsq-btn-next--active {
    background: #1a1a1a;
    color: #ffffff;
    box-shadow: 0 4px 16px -4px rgba(0, 0, 0, 0.25);
  }
  .lsq-btn-next--active:hover {
    background: #d4a340;
  }

  /* Step 6: Lead Gate */
  .lsq-gate-card {
    background: #ffffff;
    border: 1px solid #e5e5e5;
    border-radius: 32px;
    padding: clamp(40px, 6vw, 64px);
    text-align: center;
    max-width: 520px;
    margin: 0 auto;
    box-shadow: 0 20px 60px -20px rgba(0, 0, 0, 0.08);
    position: relative;
    overflow: hidden;
  }

  .lsq-gate-icon {
    width: 64px;
    height: 64px;
    background: #1a1a1a;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 24px;
    font-size: 28px;
    color: #ffffff;
  }

  .lsq-gate-title {
    font-family: 'Playfair Display', Georgia, serif;
    font-size: clamp(26px, 4vw, 38px);
    color: #1a1a1a;
    margin: 0 0 12px;
  }

  .lsq-gate-sub {
    font-family: 'Inter', Arial, sans-serif;
    font-size: 14px;
    color: rgba(26, 26, 26, 0.65);
    margin: 0 0 28px;
    line-height: 1.65;
  }

  .lsq-gate-input {
    width: 100%;
    background: #fafafa;
    border: 1px solid #e5e5e5;
    padding: 16px 20px;
    border-radius: 12px;
    font-family: 'Inter', Arial, sans-serif;
    font-size: 14px;
    color: #1a1a1a;
    margin-bottom: 12px;
    box-sizing: border-box;
    transition: border-color 0.3s;
  }
  .lsq-gate-input:focus {
    outline: none;
    border-color: #1a1a1a;
  }

  .lsq-gate-submit {
    width: 100%;
    background: #1a1a1a;
    color: #ffffff;
    font-family: 'Inter', Arial, sans-serif;
    font-size: 12px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    padding: 18px;
    border-radius: 12px;
    border: none;
    cursor: pointer;
    transition: background 0.3s;
    margin-top: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }
  .lsq-gate-submit:hover {
    background: #d4a340;
  }

  .lsq-privacy {
    font-family: 'Inter', Arial, sans-serif;
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    font-weight: 600;
    color: rgba(26, 26, 26, 0.35);
    margin: 20px 0 0;
  }

  /* Step 7: Results */
  .lsq-loading {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 60px 0;
  }

  .lsq-spinner {
    width: 48px;
    height: 48px;
    border: 3px solid rgba(26, 26, 26, 0.1);
    border-top-color: #1a1a1a;
    border-radius: 50%;
    animation: lsqSpin 1s linear infinite;
    margin-bottom: 28px;
  }
  @keyframes lsqSpin {
    100% {
      transform: rotate(360deg);
    }
  }

  .lsq-loading-title {
    font-family: 'Playfair Display', Georgia, serif;
    font-size: 24px;
    color: #1a1a1a;
    margin: 0 0 8px;
  }
  .lsq-loading-sub {
    font-family: 'Inter', Arial, sans-serif;
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    color: rgba(26, 26, 26, 0.4);
    font-weight: 700;
    animation: pulse 1.5s ease-in-out infinite;
  }
  @keyframes pulse {
    0%,
    100% {
      opacity: 1;
    }
    50% {
      opacity: 0.4;
    }
  }

  /* Result Card */
  .lsq-result-header {
    text-align: center;
    margin-bottom: 40px;
  }
  .lsq-match-badge {
    display: inline-block;
    background: #dcfce7;
    color: #166534;
    border: 1px solid #bbf7d0;
    font-family: 'Inter', Arial, sans-serif;
    font-size: 10px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    padding: 6px 18px;
    border-radius: 20px;
    margin-bottom: 16px;
  }
  .lsq-result-title {
    font-family: 'Playfair Display', Georgia, serif;
    font-size: clamp(32px, 5vw, 56px);
    color: #1a1a1a;
    margin: 0 0 12px;
    line-height: 1.1;
  }
  .lsq-result-sub {
    font-family: 'Inter', Arial, sans-serif;
    font-size: 16px;
    color: rgba(26, 26, 26, 0.65);
    max-width: 480px;
    margin: 0 auto;
  }

  .lsq-prescription {
    background: #ffffff;
    border-radius: 24px;
    border: 1px solid #e5e5e5;
    overflow: hidden;
    box-shadow: 0 16px 48px -16px rgba(0, 0, 0, 0.1);
    display: flex;
    flex-direction: column;
  }
  @media (min-width: 768px) {
    .lsq-prescription {
      flex-direction: row;
    }
  }

  .lsq-prescription-img-wrap {
    width: 100%;
    min-height: 240px;
    position: relative;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  @media (min-width: 768px) {
    .lsq-prescription-img-wrap {
      width: 50%;
      min-height: 400px;
    }
  }

  .lsq-prescription-img {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.7s;
  }
  .lsq-prescription:hover .lsq-prescription-img {
    transform: scale(1.04);
  }
  .lsq-prescription-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.06) url('https://www.transparenttextures.com/patterns/cubes.png') repeat;
    mix-blend-mode: overlay;
  }

  .lsq-prescription-details {
    width: 100%;
    padding: clamp(28px, 4vw, 52px);
    display: flex;
    flex-direction: column;
    justify-content: center;
    background: #fafafa;
    box-sizing: border-box;
  }
  @media (min-width: 768px) {
    .lsq-prescription-details {
      width: 50%;
    }
  }

  .lsq-result-name {
    font-family: 'Playfair Display', Georgia, serif;
    font-size: clamp(24px, 3vw, 34px);
    color: #1a1a1a;
    margin: 0 0 6px;
  }
  .lsq-result-actives {
    font-family: 'Inter', Arial, sans-serif;
    font-size: 12px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: rgba(26, 26, 26, 0.45);
    display: block;
    border-bottom: 1px solid #e5e5e5;
    padding-bottom: 18px;
    margin-bottom: 18px;
  }
  .lsq-result-why-label {
    font-family: 'Playfair Display', Georgia, serif;
    font-size: 17px;
    color: #1a1a1a;
    margin: 0 0 8px;
  }
  .lsq-result-desc {
    font-family: 'Inter', Arial, sans-serif;
    font-size: 13px;
    color: rgba(26, 26, 26, 0.7);
    line-height: 1.7;
    margin: 0 0 28px;
  }
  .lsq-result-cta-area {
    border-top: 1px solid #e5e5e5;
    padding-top: 22px;
    margin-top: auto;
  }
  .lsq-result-price-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
  }
  .lsq-result-price {
    font-family: 'Playfair Display', Georgia, serif;
    font-size: 24px;
    color: #1a1a1a;
  }
  .lsq-result-discount {
    font-family: 'Inter', Arial, sans-serif;
    font-size: 11px;
    font-weight: 700;
    color: #166534;
    background: #dcfce7;
    padding: 4px 10px;
    border-radius: 6px;
    border: 1px solid #bbf7d0;
  }
  .lsq-result-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    width: 100%;
    background: #1a1a1a;
    color: #ffffff;
    font-family: 'Inter', Arial, sans-serif;
    font-size: 13px;
    font-weight: 600;
    padding: 16px;
    border-radius: 12px;
    text-decoration: none;
    transition: background 0.3s;
    border: none;
    cursor: pointer;
    box-sizing: border-box;
  }
  .lsq-result-btn:hover {
    background: #d4a340;
  }
</style>

<div class="lsq-body" id="LumaQuizPage">
  <!-- Header -->
  <header class="lsq-header">
    <a href="{{ routes.root_url }}" class="lsq-logo">
      <span class="lsq-logo-icon">‚ú¶</span>
      Luma<span>Labs</span>
    </a>
    <a href="{{ routes.root_url }}" class="lsq-exit">Exit Consultation ‚úï</a>
  </header>

  <!-- Progress -->
  <div class="lsq-progress-track">
    <div class="lsq-progress-fill" id="LsqProgress"></div>
  </div>

  <main class="lsq-main">
    <!-- STEP 1: Primary Goal -->
    <div class="lsq-step is-active" data-step="1">
      <div class="lsq-step-header">
        <div class="lsq-step-counter">Question 01 of 05</div>
        <h1 class="lsq-step-title">
          What is your primary goal<br>
          for your skin right now?
        </h1>
        <p class="lsq-step-sub">This helps us determine the core active ingredient for your clinical routine.</p>
      </div>
      <div class="lsq-options">
        <label class="lsq-option">
          <input type="radio" name="q1" value="repair" onchange="lsqSelect(1, 'repair')">
          <div class="lsq-option-inner">
            <div class="lsq-option-left">
              <div class="lsq-option-icon">‚äï</div>
              <div>
                <span class="lsq-option-title">Repair damage & soothe redness.</span>
                <span class="lsq-option-sub">My barrier feels compromised, tight, or flaking.</span>
              </div>
            </div>
            <div class="lsq-check">‚úì</div>
          </div>
        </label>
        <label class="lsq-option">
          <input type="radio" name="q1" value="fade" onchange="lsqSelect(1, 'fade')">
          <div class="lsq-option-inner">
            <div class="lsq-option-left">
              <div class="lsq-option-icon">‚óé</div>
              <div>
                <span class="lsq-option-title">Fade stubborn dark spots.</span>
                <span class="lsq-option-sub">Targeting hyperpigmentation, post-acne marks, or melasma.</span>
              </div>
            </div>
            <div class="lsq-check">‚úì</div>
          </div>
        </label>
        <label class="lsq-option">
          <input type="radio" name="q1" value="prevent" onchange="lsqSelect(1, 'prevent')">
          <div class="lsq-option-inner">
            <div class="lsq-option-left">
              <div class="lsq-option-icon">‚äõ</div>
              <div>
                <span class="lsq-option-title">Prevent aging & protect.</span>
                <span class="lsq-option-sub">Maintaining structural integrity and defending against daily UV.</span>
              </div>
            </div>
            <div class="lsq-check">‚úì</div>
          </div>
        </label>
      </div>
      <div class="lsq-nav">
        <button type="button" class="lsq-btn-next lsq-btn-next--disabled" id="lsq-btn-1" onclick="lsqNext(2)">
          Continue ‚Üí
        </button>
      </div>
    </div>

    <!-- STEP 2: Mid-day feel -->
    <div class="lsq-step" data-step="2">
      <div class="lsq-step-header">
        <div class="lsq-step-counter">Question 02 of 05</div>
        <h1 class="lsq-step-title">By mid-day, how does your skin usually feel?</h1>
        <div class="lsq-lab-note lsq-lab-note--blue">
          ‚Ñπ <strong>Lab Note:</strong> Mid-day oil levels are the best indicator of your true natural skin type.
        </div>
      </div>
      <div class="lsq-options">
        <label class="lsq-option">
          <input type="radio" name="q2" value="tight" onchange="lsqSelect(2, 'tight')">
          <div class="lsq-option-inner">
            <div class="lsq-option-left">
              <div><span class="lsq-option-title">Tight, dry, and thirsty.</span></div>
            </div>
            <div class="lsq-check">‚úì</div>
          </div>
        </label>
        <label class="lsq-option">
          <input type="radio" name="q2" value="oily" onchange="lsqSelect(2, 'oily')">
          <div class="lsq-option-inner">
            <div class="lsq-option-left">
              <div><span class="lsq-option-title">Oily, shiny, or congested.</span></div>
            </div>
            <div class="lsq-check">‚úì</div>
          </div>
        </label>
        <label class="lsq-option">
          <input type="radio" name="q2" value="combo" onchange="lsqSelect(2, 'combo')">
          <div class="lsq-option-inner">
            <div class="lsq-option-left">
              <div><span class="lsq-option-title">Combination (Oily T-zone, dry cheeks).</span></div>
            </div>
            <div class="lsq-check">‚úì</div>
          </div>
        </label>
      </div>
      <div class="lsq-nav">
        <button type="button" class="lsq-btn-back" onclick="lsqBack(1)">‚Üê</button>
        <button type="button" class="lsq-btn-next lsq-btn-next--disabled" id="lsq-btn-2" onclick="lsqNext(3)">
          Continue ‚Üí
        </button>
      </div>
    </div>

    <!-- STEP 3: Barrier sensitivity -->
    <div class="lsq-step" data-step="3">
      <div class="lsq-step-header">
        <div class="lsq-step-counter">Question 03 of 05</div>
        <h1 class="lsq-step-title">How does your skin react to strong active ingredients?</h1>
        <div class="lsq-lab-note lsq-lab-note--red">
          ‚ö† <strong>Lab Note:</strong> Stinging from standard actives (like Vitamin C) typically signals a compromised
          skin barrier.
        </div>
      </div>
      <div class="lsq-options">
        <label class="lsq-option">
          <input type="radio" name="q3" value="stings" onchange="lsqSelect(3, 'stings')">
          <div class="lsq-option-inner">
            <div class="lsq-option-left">
              <div><span class="lsq-option-title">It regularly stings, turns red, or breaks out.</span></div>
            </div>
            <div class="lsq-check">‚úì</div>
          </div>
        </label>
        <label class="lsq-option">
          <input type="radio" name="q3" value="handles" onchange="lsqSelect(3, 'handles')">
          <div class="lsq-option-inner">
            <div class="lsq-option-left">
              <div><span class="lsq-option-title">It handles new ingredients perfectly fine.</span></div>
            </div>
            <div class="lsq-check">‚úì</div>
          </div>
        </label>
      </div>
      <div class="lsq-nav">
        <button type="button" class="lsq-btn-back" onclick="lsqBack(2)">‚Üê</button>
        <button type="button" class="lsq-btn-next lsq-btn-next--disabled" id="lsq-btn-3" onclick="lsqNext(4)">
          Continue ‚Üí
        </button>
      </div>
    </div>

    <!-- STEP 4: UV exposure -->
    <div class="lsq-step" data-step="4">
      <div class="lsq-step-header">
        <div class="lsq-step-counter">Question 04 of 05</div>
        <h1 class="lsq-step-title">How much sun exposure do you get on an average day?</h1>
      </div>
      <div class="lsq-options">
        <label class="lsq-option">
          <input type="radio" name="q4" value="low" onchange="lsqSelect(4, 'low')">
          <div class="lsq-option-inner">
            <div class="lsq-option-left">
              <div><span class="lsq-option-title">Low (Mostly indoors, away from windows).</span></div>
            </div>
            <div class="lsq-check">‚úì</div>
          </div>
        </label>
        <label class="lsq-option">
          <input type="radio" name="q4" value="high" onchange="lsqSelect(4, 'high')">
          <div class="lsq-option-inner">
            <div class="lsq-option-left">
              <div><span class="lsq-option-title">Moderate/High (Commuting, outdoors, near windows).</span></div>
            </div>
            <div class="lsq-check">‚úì</div>
          </div>
        </label>
      </div>
      <div class="lsq-nav">
        <button type="button" class="lsq-btn-back" onclick="lsqBack(3)">‚Üê</button>
        <button type="button" class="lsq-btn-next lsq-btn-next--disabled" id="lsq-btn-4" onclick="lsqNext(5)">
          Continue ‚Üí
        </button>
      </div>
    </div>

    <!-- STEP 5: Routine preference -->
    <div class="lsq-step" data-step="5">
      <div class="lsq-step-header">
        <div class="lsq-step-counter">Question 05 of 05</div>
        <h1 class="lsq-step-title">Are you a skincare minimalist or maximalist?</h1>
        <p class="lsq-step-sub">This helps us recommend a routine you will actually enjoy doing every day.</p>
      </div>
      <div class="lsq-options">
        <label class="lsq-option">
          <input type="radio" name="q5" value="minimal" onchange="lsqSelect(5, 'minimal')">
          <div class="lsq-option-inner">
            <div class="lsq-option-left">
              <div><span class="lsq-option-title">Minimalist (Just give me the single most important step).</span></div>
            </div>
            <div class="lsq-check">‚úì</div>
          </div>
        </label>
        <label class="lsq-option">
          <input type="radio" name="q5" value="maximal" onchange="lsqSelect(5, 'maximal')">
          <div class="lsq-option-inner">
            <div class="lsq-option-left">
              <div><span class="lsq-option-title">Comprehensive (I want the complete 3-step synergy).</span></div>
            </div>
            <div class="lsq-check">‚úì</div>
          </div>
        </label>
      </div>
      <div class="lsq-nav">
        <button type="button" class="lsq-btn-back" onclick="lsqBack(4)">‚Üê</button>
        <button type="button" class="lsq-btn-next lsq-btn-next--disabled" id="lsq-btn-5" onclick="lsqNext(6)">
          See My Results ‚Üí
        </button>
      </div>
    </div>

    <!-- STEP 6: Lead Gate -->
    <div class="lsq-step" data-step="6">
      <div class="lsq-gate-card">
        <div class="lsq-gate-icon">‚öó</div>
        <h1 class="lsq-gate-title">Your profile is ready.</h1>
        <p class="lsq-gate-sub">
          Where should we send your personalized lab routine and your <strong>10% welcome code</strong>?
        </p>
        <form onsubmit="lsqSubmit(event)">
          <input type="text" id="lsq-name" class="lsq-gate-input" placeholder="First Name" required>
          <input type="email" id="lsq-email" class="lsq-gate-input" placeholder="Email Address" required>
          <button type="submit" class="lsq-gate-submit">Unlock My Routine üîë</button>
        </form>
        <p class="lsq-privacy">We respect your inbox. Unsubscribe anytime.</p>
      </div>
    </div>

    <!-- STEP 7: Loading + Result -->
    <div class="lsq-step" data-step="7" style="width:100%; max-width:900px;">
      <div class="lsq-loading" id="LsqLoading">
        <div class="lsq-spinner"></div>
        <h2 class="lsq-loading-title">Analyzing your skin profile...</h2>
        <p class="lsq-loading-sub">Matching clinical actives</p>
      </div>
      <div id="LsqResult" style="display:none; animation: lsqFadeIn 0.5s ease forwards;">
        <div class="lsq-result-header">
          <div class="lsq-match-badge">98% Match</div>
          <h2 class="lsq-result-title">Your Custom Protocol</h2>
          <p class="lsq-result-sub" id="LsqResultSub"></p>
        </div>
        <div class="lsq-prescription">
          <div class="lsq-prescription-img-wrap" id="LsqImgWrap">
            <img class="lsq-prescription-img" id="LsqResultImg" src="" alt="Product">
            <div class="lsq-prescription-overlay"></div>
          </div>
          <div class="lsq-prescription-details">
            <h3 class="lsq-result-name" id="LsqResultName"></h3>
            <span class="lsq-result-actives" id="LsqResultActives"></span>
            <h4 class="lsq-result-why-label">Why this works for your skin:</h4>
            <p class="lsq-result-desc" id="LsqResultDesc"></p>
            <div class="lsq-result-cta-area">
              <div class="lsq-result-price-row">
                <span class="lsq-result-price" id="LsqResultPrice"></span>
                <span class="lsq-result-discount" id="LsqResultDiscountTag">10% Code Applied!</span>
              </div>
              <a href="#" class="lsq-result-btn" id="LsqResultCta">Add to Routine ‚Üí</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

<script>
  (function() {
    var WEBHOOK_URL = {{ section.settings.webhook_url | json }};
    var STORE = {{ shop.domain | json }};

    var answers = {};
    var currentStep = 1;
    var totalSteps = 6;

    var PRODUCTS = {
      barrier: {
        name: "Barrier Renew Gel-Cream",
        actives: "Triple Ceramides + Matrixyl 3000‚Ñ¢",
        sub: "Your stratum corneum requires immediate structural reconstruction.",
        desc: "Based on your answers, your lipid barrier is compromised and allowing hydration to escape. This specific 3:1:1 biomimetic lipid formula physically patches micro-tears while remaining light enough for your skin type.",
        price: "Rs. 4,598",
        discountTag: "10% Code Applied!",
        img: "https://images.unsplash.com/photo-1556228578-0d85b1a4d571?q=80&w=800&auto=format&fit=crop",
        bg: "#E0EDF8",
        url: "https://" + STORE + "/products/barrier-renew-moisturizer?discount=DATA10",
        code: "DATA10",
        ghlTrack: "quiz_result_barrier"
      },
      arbutin: {
        name: "2% Alpha Arbutin + Vitamin C",
        actives: "5-Pathway Pigment Interruption",
        sub: "You need a gentle but effective approach to fade hyperpigmentation.",
        desc: "Because your barrier is intact and handles actives well, we can safely deploy our most potent brightening compound. This serum shuts down melanin production at the source, effectively fading existing spots without irritation.",
        price: "Rs. 3,998",
        discountTag: "10% Code Applied!",
        img: "https://images.unsplash.com/photo-1580870058864-16f947ee37dd?q=80&w=800&auto=format&fit=crop",
        bg: "#FDF0C8",
        url: "https://" + STORE + "/products/2-percent-alpha-arbutin-vitamin-c?discount=DATA10",
        code: "DATA10",
        ghlTrack: "quiz_result_arbutin"
      },
      sunscreen: {
        name: "Matte UV Defence SPF 50+",
        actives: "Next-Gen Organic Filters + Niacinamide 5%",
        sub: "Your primary goal requires uncompromising daily photoprotection.",
        desc: "To prevent structural aging based on your daily routine, SPF is your highest priority active ingredient. This non-comedogenic hydrogel defends against UV degradation while actively repairing cellular inflammation with Niacinamide.",
        price: "Rs. 3,498",
        discountTag: "10% Code Applied!",
        img: "https://images.unsplash.com/photo-1616683693504-3ea7e9ad6fec?q=80&w=800&auto=format&fit=crop",
        bg: "#FEF7E6",
        url: "https://" + STORE + "/products/matte-uv-defence?discount=DATA10",
        code: "DATA10",
        ghlTrack: "quiz_result_sunscreen"
      },
      bundle: {
        name: "The Complete Luma Protocol",
        actives: "Barrier + Brightening + UV Defence",
        sub: "A comprehensive 360¬∞ protocol optimized for your skin goals.",
        desc: "You requested the maximalist approach. This 3-step synergy targets pigment production, reconstructs your lipid barrier, and provides a hydrogel shield against UV triggers. It is the ultimate clinical daily routine.",
        price: "Rs. 9,998 (Save 15%)",
        discountTag: "15% Bundle Code!",
        img: "https://images.unsplash.com/photo-1620916566398-39f1143ab7be?q=80&w=800&auto=format&fit=crop",
        bg: "#F5F5F5",
        url: "https://" + STORE + "/products/complete-luma-protocol?discount=DATA15",
        code: "DATA15",
        ghlTrack: "quiz_result_bundle"
      }
    };

    function updateProgress(step) {
      document.getElementById('LsqProgress').style.width = ((step / totalSteps) * 100) + '%';
    }

    window.lsqSelect = function(step, value) {
      answers['q' + step] = value;
      var btn = document.getElementById('lsq-btn-' + step);
      if (btn) {
        btn.classList.remove('lsq-btn-next--disabled');
        btn.classList.add('lsq-btn-next--active');
      }
    };

    window.lsqNext = function(nextStep) {
      var btn = document.getElementById('lsq-btn-' + (nextStep - 1));
      if (btn && btn.classList.contains('lsq-btn-next--disabled')) return;
      showStep(nextStep);
    };

    window.lsqBack = function(prevStep) {
      showStep(prevStep);
    };

    function showStep(n) {
      document.querySelectorAll('.lsq-step').forEach(function(el) { el.classList.remove('is-active'); });
      var target = document.querySelector('.lsq-step[data-step="' + n + '"]');
      if (target) {
        target.classList.add('is-active');
        currentStep = n;
        updateProgress(n);
      }
    }

    window.lsqSubmit = function(e) {
      e.preventDefault();
      answers.first_name = document.getElementById('lsq-name').value.trim();
      answers.email = document.getElementById('lsq-email').value.trim();

      // Determine recommendation
      var rec = 'barrier';
      if (answers.q5 === 'maximal') {
        rec = 'bundle';
      } else if (answers.q3 === 'stings' || answers.q1 === 'repair') {
        rec = 'barrier';
      } else if (answers.q1 === 'fade' && answers.q3 === 'handles') {
        rec = 'arbutin';
      } else if (answers.q1 === 'prevent') {
        rec = 'sunscreen';
      }
      answers.recommendation = rec;
      answers.ghl_tag = PRODUCTS[rec].ghlTrack;
      answers.discount_code = PRODUCTS[rec].code;

      showStep(7);
      updateProgress(7);

      // Fire webhook
      if (WEBHOOK_URL && !WEBHOOK_URL.includes('YOUR_WEBHOOK')) {
        fetch(WEBHOOK_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(answers)
        }).catch(function(err) { console.warn('Luma Quiz webhook error:', err); });
      }

      // Show result after delay
      setTimeout(function() {
        var data = PRODUCTS[rec];
        document.getElementById('LsqResultSub').textContent = data.sub;
        document.getElementById('LsqResultName').textContent = data.name;
        document.getElementById('LsqResultActives').textContent = data.actives;
        document.getElementById('LsqResultDesc').textContent = data.desc;
        document.getElementById('LsqResultPrice').textContent = data.price;
        document.getElementById('LsqResultDiscountTag').textContent = data.discountTag;
        document.getElementById('LsqResultImg').src = data.img;
        document.getElementById('LsqResultCta').href = data.url;
        document.getElementById('LsqImgWrap').style.background = data.bg;

        document.getElementById('LsqLoading').style.display = 'none';
        document.getElementById('LsqResult').style.display = 'block';
      }, 2600);
    };

    updateProgress(1);
  })();
</script>

{% schema %}
{
  "name": "Luma AI Skin Quiz",
  "settings": [
    {
      "type": "text",
      "id": "webhook_url",
      "label": "Make.com Webhook URL",
      "placeholder": "https://hook.us1.make.com/YOUR_ID",
      "info": "Paste the Webhook URL from Make.com. The quiz will POST a JSON payload with all answers plus the recommended product and GHL tag."
    }
  ],
  "presets": [
    {
      "name": "Luma AI Skin Quiz"
    }
  ]
}
{% endschema %}
