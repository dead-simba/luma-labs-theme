{% schema %}
{
  "name": "Ingredients Accordion",
  "tag": "section",
  "class": "section-ingredients",
  "settings": [
    {
      "type": "header",
      "content": "Section Header"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Ingredients"
    },
    {
      "type": "header",
      "content": "Style Settings"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background Color",
      "default": "#FFFFFF"
    },
    {
      "type": "range",
      "id": "bg_opacity",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "%",
      "label": "Background Opacity",
      "default": 100
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#1A1A1A"
    },
    {
      "type": "color",
      "id": "accent_color",
      "label": "Accent Color (Plus Sign)",
      "default": "#C5A065"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "section_width",
      "label": "Section Width",
      "options": [
        { "value": "800px", "label": "Narrow (800px)" },
        { "value": "1200px", "label": "Standard (1200px)" },
        { "value": "100%", "label": "Full Width" }
      ],
      "default": "800px"
    },
    {
      "type": "select",
      "id": "heading_alignment",
      "label": "Heading Alignment",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" }
      ],
      "default": "left"
    },
    {
      "type": "header",
      "content": "Typography"
    },
    {
      "type": "paragraph",
      "content": "By default, this section uses your Theme Settings. Check the box below to customize fonts."
    },
    {
      "type": "checkbox",
      "id": "override_fonts",
      "label": "Override Theme Fonts",
      "default": false
    },
    {
      "type": "font_picker",
      "id": "heading_font",
      "label": "Heading Font",
      "default": "serif"
    },
    {
      "type": "font_picker",
      "id": "body_font",
      "label": "Body Font",
      "default": "sans-serif"
    }
  ],
  "blocks": [
    {
      "type": "ingredient",
      "name": "Ingredient Item",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Ingredient Name",
          "default": "1% Hyaluronic Acid (The Hydrator)"
        },
        {
          "type": "textarea",
          "id": "description",
          "label": "Description",
          "default": "Acts as a moisture sponge for your skin cells, ensuring deep hydration without clogging pores."
        },
        {
          "type": "checkbox",
          "id": "show_plus",
          "label": "Show Accent Plus/Minus (Left)",
          "default": true
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Ingredients Accordion",
      "blocks": [
        { "type": "ingredient", "settings": { "title": "1% Hyaluronic Acid (The Hydrator)", "description": "Acts as a moisture sponge for your skin cells, ensuring deep hydration without clogging pores."} },
        { "type": "ingredient", "settings": { "title": "Titanium Dioxide (The Shield)", "description": "A gentle physical UV filter. We use a micronized version that disperses evenly."} },
        { "type": "ingredient", "settings": { "title": "Vitamin E (The Repairer)", "description": "An antioxidant that supports the skin barrier. It helps calm inflammation."} },
        { "type": "ingredient", "settings": { "title": "All Ingredients", "description": "Aqua, Ethylhexyl Methoxycinnamate, Butyl Methoxydibenzoylmethane, Benzophenone-3, Phospholipids, 1,3-Butylene Glycol, Glycerin, Sodium Hyaluronate, Tocopheryl Acetate (Vitamin E), Titanium Dioxide, Silica, Phenoxyethanol, Ethylhexylglycerin.", "show_plus": false} }
      ]
    }
  ]
}
{% endschema %}

{%- style -%}
  /* Font Loading (Only if Override is ON) */
  {%- if section.settings.override_fonts -%}
    {{ section.settings.heading_font | font_face: font_display: 'swap' }}
    {{ section.settings.body_font | font_face: font_display: 'swap' }}
  {%- endif -%}

  {%- assign bg_alpha = section.settings.bg_opacity | divided_by: 100.0 -%}
  {%- assign bg_final = section.settings.bg_color | color_modify: 'alpha', bg_alpha -%}

  #shopify-section-{{ section.id }} .ingredients-section {
    background-color: {{ bg_final }};
    padding: 60px 20px;
    color: {{ section.settings.text_color }};
    
    /* Body Font Logic */
    {%- if section.settings.override_fonts and section.settings.body_font != blank -%}
      font-family: {{ section.settings.body_font.family }}, {{ section.settings.body_font.fallback_families }};
    {%- elsif settings.type_body_font != blank -%}
      font-family: {{ settings.type_body_font.family }}, {{ settings.type_body_font.fallback_families }};
    {%- elsif settings.type_base_font != blank -%}
      font-family: {{ settings.type_base_font.family }}, {{ settings.type_base_font.fallback_families }};
    {%- else -%}
      font-family: inherit;
    {%- endif -%}
  }

  #shopify-section-{{ section.id }} .ingredients-container {
    max-width: {{ section.settings.section_width }};
    margin: 0 auto;
  }

  /* Heading */
  #shopify-section-{{ section.id }} .ingredients-title {
    font-size: 30px;
    margin-bottom: 48px;
    font-weight: 400;
    line-height: 1.2;
    text-align: {{ section.settings.heading_alignment }};
    
    /* Heading Font Logic */
    {%- if section.settings.override_fonts and section.settings.heading_font != blank -%}
      font-family: {{ section.settings.heading_font.family }}, {{ section.settings.heading_font.fallback_families }};
    {%- elsif settings.type_heading_font != blank -%}
      font-family: {{ settings.type_heading_font.family }}, {{ settings.type_heading_font.fallback_families }};
    {%- else -%}
      font-family: inherit;
    {%- endif -%}
  }

  /* Accordion Styles */
  #shopify-section-{{ section.id }} .accordion-wrapper {
    border-top: 1px solid #e5e7eb;
  }

  #shopify-section-{{ section.id }} details.ingredient-item {
    border-bottom: 1px solid #e5e7eb;
    cursor: pointer;
    transition: background-color 0.2s;
  }

  #shopify-section-{{ section.id }} details.ingredient-item summary {
    list-style: none; /* Remove default triangle */
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 24px 0;
    font-size: 14px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    user-select: none;
    transition: color 0.2s;
  }
  
  /* Hide default details marker in specific browsers */
  #shopify-section-{{ section.id }} details.ingredient-item summary::-webkit-details-marker {
    display: none;
  }

  #shopify-section-{{ section.id }} details.ingredient-item[open] summary {
    color: {{ section.settings.accent_color }};
  }

  /* Left Icon styles */
  #shopify-section-{{ section.id }} .icon-left {
    color: {{ section.settings.accent_color }};
    margin-right: 12px;
  }

  #shopify-section-{{ section.id }} .icon-left-minus {
    color: #9ca3af; /* Gray-400 equivalent */
    margin-right: 12px;
  }

  /* Right Toggle Icon (+ -> x animation) */
  #shopify-section-{{ section.id }} .icon-toggle {
    font-size: 20px;
    font-weight: 300;
    color: #9ca3af;
    transition: transform 0.3s ease;
  }

  #shopify-section-{{ section.id }} details[open] .icon-toggle {
    transform: rotate(45deg);
  }

  /* Content */
  #shopify-section-{{ section.id }} .ingredient-content {
    padding-bottom: 24px;
    padding-left: 24px;
    font-size: 14px;
    line-height: 1.6;
    color: #4b5563; /* Gray-600 */
    font-weight: 300;
    max-width: 90%;
  }

{%- endstyle -%}

<div class="ingredients-section">
    <div class="ingredients-container">
        
        {%- if section.settings.title != blank -%}
            <h2 class="ingredients-title">{{ section.settings.title | escape }}</h2>
        {%- endif -%}

        <div class="accordion-wrapper">
            {%- for block in section.blocks -%}
                <details class="ingredient-item" {{ block.shopify_attributes }}>
                    <summary>
                        <span style="display: flex; align-items: center;">
                            {%- if block.settings.show_plus -%}
                                <span class="icon-left">+</span>
                            {%- else -%}
                                <span class="icon-left-minus">â€“</span>
                            {%- endif -%}
                            {{ block.settings.title | escape }}
                        </span>
                        <span class="icon-toggle">+</span>
                    </summary>
                    <div class="ingredient-content">
                        {{ block.settings.description | escape }}
                    </div>
                </details>
            {%- endfor -%}
        </div>

    </div>
</div>
