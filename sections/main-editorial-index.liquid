{{ 'main-editorial-index.css' | asset_url | stylesheet_tag }}

{%- paginate blog.articles by section.settings.number_of_blog_posts -%}
  <div class="editorial-index">
    <!-- Editorial Header / Manifesto -->
    <section class="editorial-manifesto">
      <div class="editorial-manifesto__gradient"></div>
      <div class="editorial-manifesto__container">
        <div class="editorial-manifesto__wrapper">
          <span class="editorial-manifesto__kicker editorial-index__uppercase-tracking editorial-index__font-sans">
            {{- section.settings.manifesto_kicker -}}
          </span>
          <h1 class="editorial-manifesto__headline editorial-index__font-serif">
            {{ section.settings.manifesto_headline }}
          </h1>
          <p class="editorial-manifesto__description editorial-index__text-light editorial-index__font-sans">
            {{ section.settings.manifesto_text }}
          </p>
        </div>
      </div>
    </section>

    <main class="editorial-main">
      {%- if section.settings.show_featured_article and blog.articles.size > 0 -%}
        {%- assign featured_article = blog.articles.first -%}
        <!-- Featured Hero Article -->
        <a href="{{ featured_article.url }}" class="editorial-featured">
          <div class="editorial-featured__image-wrapper">
            {%- if featured_article.image -%}
              <img
                src="{{ featured_article.image | image_url: width: 1600 }}"
                alt="{{ featured_article.image.alt | escape }}"
                class="editorial-featured__image"
                loading="lazy"
              >
            {%- endif -%}
            <div class="editorial-featured__badge">
              <span class="editorial-index__uppercase-tracking editorial-index__font-sans" style="font-size: 9px;"
                >Latest Directive</span
              >
            </div>
          </div>

          <div class="editorial-featured__content">
            <div class="editorial-meta">
              {%- if featured_article.tags.size > 0 -%}
                <span class="editorial-index__uppercase-tracking editorial-index__gold editorial-index__font-sans">
                  {{- featured_article.tags.first -}}
                </span>
                <span class="editorial-meta__dot"></span>
              {%- endif -%}
              <span class="editorial-meta__read-time editorial-index__uppercase-tracking editorial-index__font-sans">
                {{- featured_article.content | strip_html | split: ' ' | size | divided_by: 200 | at_least: 1 }} Min
                Read</span
              >
            </div>

            <h2 class="editorial-featured__title editorial-index__font-serif">
              {{ featured_article.title }}
            </h2>

            <p class="editorial-excerpt editorial-index__font-sans">
              {%- if featured_article.excerpt.size > 0 -%}
                {{ featured_article.excerpt | strip_html | truncatewords: 30 }}
              {%- else -%}
                {{ featured_article.content | strip_html | truncatewords: 30 }}
              {%- endif -%}
            </p>

            <div class="editorial-featured__footer">
              <div class="editorial-author">
                <div class="editorial-author__avatar editorial-index__font-serif">
                  {{ featured_article.author | slice: 0, 1 | upcase }}
                </div>
                <span class="editorial-author__name editorial-index__font-sans">{{ featured_article.author }}</span>
              </div>
              <span class="editorial-read-more editorial-index__uppercase-tracking editorial-index__font-sans">
                Read â†’
              </span>
            </div>
          </div>
        </a>
      {%- endif -%}

      <!-- Category Filters -->
      {%- if blog.all_tags.size > 0 -%}
        <div class="editorial-filters">
          <a
            href="{{ blog.url }}"
            class="editorial-filter-btn editorial-index__uppercase-tracking editorial-index__font-sans {% if current_tags == blank %}editorial-filter-btn--active{% endif %}"
            >All Articles</a
          >
          {%- for tag in blog.all_tags -%}
            <a
              href="{{ blog.url }}/tagged/{{ tag | handle }}"
              class="editorial-filter-btn editorial-index__uppercase-tracking editorial-index__font-sans {% if current_tags contains tag %}editorial-filter-btn--active{% endif %}"
            >
              {{- tag -}}
            </a>
          {%- endfor -%}
        </div>
      {%- endif -%}

      <!-- Article Grid -->
      <div class="editorial-grid">
        {%- for article in blog.articles -%}
          {%- if section.settings.show_featured_article and forloop.first == true and current_page == 1 -%}
            {%- continue -%}
          {%- endif -%}

          <!-- Standard Article Card -->
          <a href="{{ article.url }}" class="editorial-card">
            <div class="editorial-card__image-wrapper">
              {%- if article.image -%}
                <img
                  src="{{ article.image | image_url: width: 800 }}"
                  alt="{{ article.image.alt | escape }}"
                  class="editorial-card__image"
                  loading="lazy"
                >
              {%- endif -%}
            </div>

            <div class="editorial-card__content">
              <div class="editorial-meta">
                {%- if article.tags.size > 0 -%}
                  <span
                    class="editorial-index__uppercase-tracking editorial-index__gold editorial-index__font-sans"
                    style="font-size: 9px;"
                  >
                    {{- article.tags.first -}}
                  </span>
                  <span class="editorial-meta__dot"></span>
                {%- endif -%}
                <span
                  class="editorial-meta__read-time editorial-index__uppercase-tracking editorial-index__font-sans"
                  style="font-size: 9px;"
                >
                  {{- article.content | strip_html | split: ' ' | size | divided_by: 200 | at_least: 1 }} Min Read</span
                >
              </div>

              <h3 class="editorial-card__title editorial-index__font-serif">
                {{ article.title }}
              </h3>

              <p class="editorial-excerpt editorial-index__font-sans">
                {%- if article.excerpt.size > 0 -%}
                  {{ article.excerpt | strip_html | truncatewords: 25 }}
                {%- else -%}
                  {{ article.content | strip_html | truncatewords: 25 }}
                {%- endif -%}
              </p>

              <div class="editorial-card__footer editorial-index__uppercase-tracking editorial-index__font-sans">
                {{ article.author }}
              </div>
            </div>
          </a>

          {%- if forloop.index == 3 and section.settings.show_newsletter -%}
            <!-- Newsletter Injection -->
            <div class="editorial-newsletter">
              <div class="editorial-newsletter__icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="#D4A340" viewBox="0 0 256 256">
                  <path d="M224,48H32a8,8,0,0,0-8,8V192a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V56A8,8,0,0,0,224,48ZM203.43,64,128,133.15,52.57,64ZM216,192H40V74.19l82.59,75.71a16,16,0,0,0,21.82,0L216,74.19V192Z"></path>
                </svg>
              </div>
              <h3 class="editorial-newsletter__headline editorial-index__font-serif">
                {{ section.settings.newsletter_headline }}
              </h3>
              <p class="editorial-newsletter__text editorial-index__font-sans">
                {{ section.settings.newsletter_text }}
              </p>
              {% form 'customer', class: 'editorial-newsletter__form' %}
                <input type="hidden" name="contact[tags]" value="newsletter, blog_subscriber">
                <input
                  type="email"
                  name="contact[email]"
                  placeholder="Email address"
                  class="editorial-newsletter__input"
                  required
                >
                <button
                  type="submit"
                  class="editorial-newsletter__submit editorial-index__uppercase-tracking editorial-index__font-sans"
                >
                  Subscribe
                </button>
              {% endform %}
            </div>
          {%- endif -%}
        {%- endfor -%}
      </div>

      <!-- Pagination -->
      {%- if paginate.pages > 1 -%}
        <div class="editorial-pagination">
          {%- render 'pagination', paginate: paginate -%}
        </div>
      {%- endif -%}
    </main>
  </div>
{%- endpaginate -%}

{% schema %}
{
  "name": "Editorial Index",
  "settings": [
    {
      "type": "range",
      "id": "number_of_blog_posts",
      "step": 1,
      "min": 1,
      "max": 24,
      "label": "Posts per page",
      "default": 13
    },
    {
      "type": "header",
      "content": "Manifesto Hero"
    },
    {
      "type": "text",
      "id": "manifesto_kicker",
      "label": "Kicker",
      "default": "The Luma Directives"
    },
    {
      "type": "html",
      "id": "manifesto_headline",
      "label": "Headline",
      "default": "Clinical Truths for <br><i style=\"color: rgba(255,255,255,0.6); font-style: italic;\">South Asian</i> Skin."
    },
    {
      "type": "textarea",
      "id": "manifesto_text",
      "label": "Description",
      "default": "The skincare industry wasn't built for our climate, our biology, or our UV index. We are dismantling the myths and explaining exactly what happens at the cellular level. Unfiltered, biological facts."
    },
    {
      "type": "checkbox",
      "id": "show_featured_article",
      "label": "Highlight featured (first) article on page 1",
      "default": true
    },
    {
      "type": "header",
      "content": "Newsletter Injection"
    },
    {
      "type": "checkbox",
      "id": "show_newsletter",
      "label": "Show newsletter block",
      "default": true
    },
    {
      "type": "text",
      "id": "newsletter_headline",
      "label": "Headline",
      "default": "The Formulation Newsletter"
    },
    {
      "type": "textarea",
      "id": "newsletter_text",
      "label": "Body text",
      "default": "Join 14,000+ others receiving our clinical deep-dives and early access to new protocols."
    }
  ],
  "presets": [
    {
      "name": "Editorial Index"
    }
  ]
}
{% endschema %}
