{{ 'main-editorial-article.css' | asset_url | stylesheet_tag }}

<div class="editorial-article">
  <!-- Reading Progress Bar -->
  <div class="editorial-progress">
    <div id="progress-bar" class="editorial-progress__bar"></div>
  </div>

  <!-- Article Hero -->
  <header class="editorial-hero">
    <!-- Breadcrumb / Category -->
    <div class="editorial-hero__meta editorial-article__uppercase-tracking editorial-article__font-sans">
      {%- if article.tags.size > 0 -%}
        <a href="{{ blog.url }}/tagged/{{ article.tags.first | handle }}" class="editorial-hero__tag">
          {{- article.tags.first -}}
        </a>
        <span class="editorial-hero__dot"></span>
      {%- endif -%}
      <span class="editorial-hero__read-time">
        {{- article.content | strip_html | split: ' ' | size | divided_by: 200 | at_least: 1 }} Min Read</span
      >
    </div>

    <h1 class="editorial-hero__title editorial-article__font-serif">
      {{ article.title }}
    </h1>

    <p class="editorial-hero__excerpt editorial-article__font-sans">
      {%- if article.excerpt.size > 0 -%}
        {{ article.excerpt | strip_html }}
      {%- else -%}
        {{ article.content | strip_html | truncatewords: 25 }}
      {%- endif -%}
    </p>

    <!-- Featured Image -->
    {%- if article.image -%}
      <div class="editorial-hero__image-wrapper">
        <img
          src="{{ article.image | image_url: width: 2000 }}"
          alt="{{ article.image.alt | escape }}"
          class="editorial-hero__image"
        >
      </div>
    {%- endif -%}
  </header>

  <!-- Article Layout grid -->
  <main class="editorial-layout">
    <!-- Left Sidebar: Author & Share (Sticky on desktop) -->
    <aside class="editorial-sidebar editorial-sidebar--left">
      <div class="editorial-sidebar__sticky">
        <!-- Author Info -->
        <div class="editorial-author-block">
          {%- assign author_name = article.author | handleize -%}
          <div class="editorial-author-block__avatar editorial-article__font-serif">
            {{ article.author | slice: 0, 1 | upcase }}
          </div>
          <h3 class="editorial-author-block__name editorial-article__font-serif">{{ article.author }}</h3>
          <span class="editorial-author-block__title editorial-article__uppercase-tracking editorial-article__font-sans"
            >Formulation Writer</span
          >
        </div>

        <!-- Share Actions -->
        <div class="editorial-share">
          <span class="editorial-share__title editorial-article__uppercase-tracking editorial-article__font-sans"
            >Share Article</span
          >
          <div class="editorial-share__links">
            <a
              href="https://twitter.com/intent/tweet?text={{ article.title | url_param_escape }}&url={{ shop.url | append: article.url }}"
              target="_blank"
              class="editorial-share__link"
            >
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256">
                <path d="M214.75,212.65,156.46,128.5,215,62.13a8,8,0,0,0-12-10.61L150.8,109.81,107.57,47.41A8,8,0,0,0,101,44H41a8,8,0,0,0-6.52,12.66l58.29,84.14L34.19,207.13a8,8,0,0,0,12,10.61L98.66,158.4l43.23,62.37A8,8,0,0,0,148.45,224H208.5a8,8,0,0,0,6.25-11.35ZM58,58.8H94l98.3,141.87h-36Z"></path>
              </svg>
            </a>
            <a
              href="https://www.facebook.com/sharer.php?u={{ shop.url | append: article.url }}"
              target="_blank"
              class="editorial-share__link"
            >
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256">
                <path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm8,191.63V152h24a8,8,0,0,0,0-16H136V112a16,16,0,0,1,16-16h16a8,8,0,0,0,0-16H152a32,32,0,0,0-32,32v24H96a8,8,0,0,0,0,16h24v63.63a88,88,0,1,1,16,0Z"></path>
              </svg>
            </a>
          </div>
        </div>
      </div>
    </aside>

    <!-- Center content: The Article Body -->
    <article class="editorial-content">
      <!-- Mobile Author block (hidden on lg) -->
      <div class="editorial-author-mobile">
        <div class="editorial-author-mobile__avatar editorial-article__font-serif">
          {{ article.author | slice: 0, 1 | upcase }}
        </div>
        <div>
          <h3 class="editorial-author-mobile__name editorial-article__font-serif">{{ article.author }}</h3>
          <span class="editorial-author-mobile__title editorial-article__uppercase-tracking editorial-article__font-sans"
            >Formulation Writer</span
          >
        </div>
      </div>

      <!-- Content -->
      <div class="editorial-prose">
        {{ article.content }}
      </div>

      {%- assign custom_handle = article.metafields.custom.inline_upsell_product.value
        | default: article.metafields.custom.inline_upsell_product
      -%}
      {%- if custom_handle != blank -%}
        {%- assign product = all_products[custom_handle] -%}
      {%- else -%}
        {%- assign product = all_products[section.settings.upsell_product] -%}
      {%- endif -%}

      {%- if section.settings.show_inline_upsell and product != blank -%}
        <!-- Inline Product Upsell Block -->
        <div class="editorial-inline-upsell">
          <div class="editorial-inline-upsell__image-wrapper">
            <img
              src="{{ product.featured_image | image_url: width: 400 }}"
              class="editorial-inline-upsell__image"
              alt="{{ product.title | escape }}"
            >
          </div>
          <div class="editorial-inline-upsell__content">
            <span class="editorial-inline-upsell__badge editorial-article__uppercase-tracking"
              >⚗️ Clinical Lab Note</span
            >
            <h4 class="editorial-inline-upsell__title editorial-article__font-serif">{{ product.title }}</h4>
            <p class="editorial-inline-upsell__desc">
              {%- assign custom_desc = article.metafields.custom.inline_upsell_text.value
                | default: article.metafields.custom.inline_upsell_text
              -%}
              {%- if custom_desc != blank -%}
                {{ custom_desc }}
              {%- else -%}
                {{
                  section.settings.upsell_description
                  | default: product.description
                  | strip_html
                  | truncatewords: 25
                }}
              {%- endif -%}
            </p>
            <a href="{{ product.url }}" class="editorial-inline-upsell__btn editorial-article__uppercase-tracking">
              View Formulation
            </a>
          </div>
        </div>
      {%- endif -%}
    </article>

    <!-- Right Sidebar: Read Next / Upsell -->
    <aside class="editorial-sidebar editorial-sidebar--right">
      <div class="editorial-sidebar__sticky">
        <h4 class="editorial-sidebar__heading editorial-article__font-serif">Read Next</h4>

        {%- assign current_article_id = article.id -%}
        {%- assign counter = 0 -%}
        {%- for related_article in blog.articles -%}
          {%- if related_article.id != current_article_id and counter < 2 -%}
            <!-- Recirculation Card -->
            <a href="{{ related_article.url }}" class="editorial-read-next">
              <div class="editorial-read-next__image-wrapper">
                {%- if related_article.image -%}
                  <img
                    src="{{ related_article.image | image_url: width: 400 }}"
                    class="editorial-read-next__image"
                    loading="lazy"
                  >
                {%- endif -%}
              </div>
              {%- if related_article.tags.size > 0 -%}
                <span class="editorial-read-next__tag editorial-article__uppercase-tracking">
                  {{- related_article.tags.first -}}
                </span>
              {%- endif -%}
              <h5 class="editorial-read-next__title editorial-article__font-serif">{{ related_article.title }}</h5>
            </a>
            {%- assign counter = counter | plus: 1 -%}
          {%- endif -%}
        {%- endfor -%}

        {%- if section.settings.show_sidebar_upsell and section.settings.sidebar_upsell_product != blank -%}
          {%- assign sidebar_product = all_products[section.settings.sidebar_upsell_product] -%}
          <!-- Protocol CTA -->
          <div class="editorial-sidebar-cta">
            <span class="editorial-sidebar-cta__icon">✨</span>
            <h4 class="editorial-sidebar-cta__title editorial-article__font-serif">{{ sidebar_product.title }}</h4>
            <p class="editorial-sidebar-cta__tagline editorial-article__uppercase-tracking">
              {{ section.settings.sidebar_upsell_tagline | default: 'Brighten. Rebuild. Protect.' }}
            </p>
            <a href="{{ sidebar_product.url }}" class="editorial-sidebar-cta__btn editorial-article__uppercase-tracking"
              >Shop</a
            >
          </div>
        {%- endif -%}
      </div>
    </aside>
  </main>

  <!-- Reading Progress JS -->
  <script>
    window.addEventListener('scroll', function () {
      var winScroll = document.body.scrollTop || document.documentElement.scrollTop;
      var height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
      var scrolled = winScroll / height;
      document.getElementById('progress-bar').style.transform = 'scaleX(' + scrolled + ')';
    });
  </script>
</div>
{% schema %}
{
  "name": "Editorial Article",
  "settings": [
    {
      "type": "header",
      "content": "Inline Upsell"
    },
    {
      "type": "checkbox",
      "id": "show_inline_upsell",
      "label": "Show inline product upsell",
      "default": true
    },
    {
      "type": "product",
      "id": "upsell_product",
      "label": "Product to feature inline"
    },
    {
      "type": "textarea",
      "id": "upsell_description",
      "label": "Custom description (optional)",
      "info": "Leave blank to use product default description"
    },
    {
      "type": "header",
      "content": "Sidebar Upsell"
    },
    {
      "type": "checkbox",
      "id": "show_sidebar_upsell",
      "label": "Show sidebar bundle upsell",
      "default": true
    },
    {
      "type": "product",
      "id": "sidebar_upsell_product",
      "label": "Product to feature in sidebar"
    },
    {
      "type": "text",
      "id": "sidebar_upsell_tagline",
      "label": "Tagline",
      "default": "Brighten. Rebuild. Protect."
    }
  ],
  "presets": [
    {
      "name": "Editorial Article"
    }
  ]
}
{% endschema %}
