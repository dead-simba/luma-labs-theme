{% schema %}
{
  "name": "Community / Reviews",
  "tag": "section",
  "class": "section-community",
  "settings": [
    {
      "type": "header",
      "content": "Section Header"
    },
    {
      "type": "text",
      "id": "eyebrow",
      "label": "Eyebrow Text",
      "default": "Community Love"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Main Heading",
      "default": "Real Results. Real Skin."
    },
    {
      "type": "text",
      "id": "rating_text",
      "label": "Rating Text",
      "default": "Based on 1,200+ Reviews"
    },
    {
      "type": "header",
      "content": "Layout Settings"
    },
    {
      "type": "select",
      "id": "section_width",
      "label": "Section Width",
      "options": [
        { "value": "800px", "label": "Narrow (800px)" },
        { "value": "1280px", "label": "Standard (1280px)" },
        { "value": "100%", "label": "Full Width" }
      ],
      "default": "1280px"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 20,
      "max": 120,
      "step": 4,
      "unit": "px",
      "label": "Top Padding",
      "default": 96
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 20,
      "max": 120,
      "step": 4,
      "unit": "px",
      "label": "Bottom Padding",
      "default": 96
    },
    {
      "type": "header",
      "content": "Style Settings"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background Color",
      "default": "#F9F8F6"
    },
    {
      "type": "color",
      "id": "card_bg_color",
      "label": "Card Background Color",
      "default": "#FFFFFF"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#1A1A1A"
    },
    {
      "type": "color",
      "id": "accent_color",
      "label": "Accent Color (Star/Gold)",
      "default": "#D4A340"
    },
    {
      "type": "header",
      "content": "Typography"
    },
    {
      "type": "checkbox",
      "id": "override_fonts",
      "label": "Override Theme Fonts",
      "default": false
    },
    {
      "type": "font_picker",
      "id": "heading_font",
      "label": "Heading Font",
      "default": "serif"
    },
    {
      "type": "font_picker",
      "id": "body_font",
      "label": "Body Font",
      "default": "sans-serif"
    }
  ],
  "blocks": [
    {
      "type": "review",
      "name": "Review Card",
      "settings": [
        {
          "type": "text",
          "id": "review_title",
          "label": "Review Title",
          "default": "\"My melasma is finally fading.\""
        },
        {
          "type": "textarea",
          "id": "quote",
          "label": "Review Quote",
          "default": "I've tried everything for my post-pregnancy melasma. Hydroquinone was too harsh, and Vitamin C didn't do enough. This serum is the sweet spot. After 4 weeks, the dark patches on my cheeks have visibly lightened."
        },
        {
          "type": "text",
          "id": "author",
          "label": "Author Name",
          "default": "Sarah M."
        },
        {
          "type": "checkbox",
          "id": "verified",
          "label": "Show Verified Buyer",
          "default": true
        },
        {
          "type": "image_picker",
          "id": "author_image",
          "label": "Author Image"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Community / Reviews",
      "blocks": [{ "type": "review" }, { "type": "review" }, { "type": "review" }]
    }
  ]
}
{% endschema %}

{%- style -%}
  /* Font Loading */
  {%- if section.settings.override_fonts -%}
    {{ section.settings.heading_font | font_face: font_display: 'swap' }}
    {{ section.settings.body_font | font_face: font_display: 'swap' }}
  {%- endif -%}

  #shopify-section-{{ section.id }} .community-section {
    background-color: {{ section.settings.bg_color }};
    padding-top: {{ section.settings.padding_top }}px;
    padding-bottom: {{ section.settings.padding_bottom }}px;
    color: {{ section.settings.text_color }};

    {%- if section.settings.override_fonts and section.settings.body_font != blank -%}
      font-family: {{ section.settings.body_font.family }}, {{ section.settings.body_font.fallback_families }};
    {%- elsif settings.type_body_font != blank -%}
      font-family: {{ settings.type_body_font.family }}, {{ settings.type_body_font.fallback_families }};
    {%- elsif settings.type_base_font != blank -%}
      font-family: {{ settings.type_base_font.family }}, {{ settings.type_base_font.fallback_families }};
    {%- else -%}
      font-family: inherit;
    {%- endif -%}
  }

  #shopify-section-{{ section.id }} .community-container {
    max-width: {{ section.settings.section_width }};
    margin: 0 auto;
    padding: 0 20px;
  }

  /* Header Styles */
  #shopify-section-{{ section.id }} .section-header {
    text-align: center;
    max-width: 672px; /* max-w-2xl */
    margin: 0 auto 64px auto;
  }

  #shopify-section-{{ section.id }} .eyebrow {
    color: {{ section.settings.accent_color }};
    font-size: 12px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    display: block;
    margin-bottom: 8px;
  }

  #shopify-section-{{ section.id }} .main-title {
    font-size: 36px; /* text-4xl approx */
    margin-bottom: 16px;
    font-weight: 400;
    line-height: 1.2;
    color: {{ section.settings.text_color }};

    {%- if section.settings.override_fonts and section.settings.heading_font != blank -%}
      font-family: {{ section.settings.heading_font.family }}, {{ section.settings.heading_font.fallback_families }};
    {%- elsif settings.type_heading_font != blank -%}
      font-family: {{ settings.type_heading_font.family }}, {{ settings.type_heading_font.fallback_families }};
    {%- else -%}
      font-family: inherit;
    {%- endif -%}
  }

  #shopify-section-{{ section.id }} .rating-block {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }

  #shopify-section-{{ section.id }} .stars svg {
    color: {{ section.settings.accent_color }};
    fill: currentColor;
    width: 20px;
    height: 20px;
    display: inline-block;
  }

  #shopify-section-{{ section.id }} .rating-text {
    font-size: 14px;
    color: rgba(26, 26, 26, 0.7);
    margin-left: 8px;
  }

  /* Grid Styles */
  #shopify-section-{{ section.id }} .reviews-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 32px;
  }

  @media (min-width: 768px) {
    #shopify-section-{{ section.id }} .reviews-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  /* Card Styles */
  #shopify-section-{{ section.id }} .review-card {
    background-color: {{ section.settings.card_bg_color }};
    padding: 32px;
    border-radius: 16px; /* rounded-2xl */
    border: 1px solid #E5E5E5; /* border-luma-lightGray */
    box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); /* shadow-sm */
    display: flex;
    flex-direction: column;
  }

  #shopify-section-{{ section.id }} .card-stars {
    display: flex;
    gap: 4px;
    margin-bottom: 16px;
  }

  #shopify-section-{{ section.id }} .card-stars svg {
    color: {{ section.settings.accent_color }};
    fill: currentColor;
    width: 16px;
    height: 16px;
  }

  #shopify-section-{{ section.id }} .review-title {
    font-weight: 700;
    font-size: 18px; /* text-lg */
    color: {{ section.settings.text_color }};
    margin: 0 0 8px 0; /* mb-2 */
    line-height: 1.4;
  }

  #shopify-section-{{ section.id }} .review-text {
    color: rgba(26, 26, 26, 0.8);
    margin-bottom: 24px;
    line-height: 1.6;
    font-size: 16px;
    flex-grow: 1;
    /* Optional: implement line-clamp logic if extremely long, but typically handled securely by content. */
  }

  #shopify-section-{{ section.id }} .author-block {
    display: flex;
    align-items: center;
    gap: 16px;
    border-top: 1px solid #E5E5E5; /* border-t pt-4 */
    padding-top: 16px;
  }

  #shopify-section-{{ section.id }} .author-img {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    object-fit: cover;
  }

  #shopify-section-{{ section.id }} .author-placeholder {
     width: 40px;
     height: 40px;
     border-radius: 50%;
     background-color: rgba(212, 163, 64, 0.2); /* bg-luma-gold/20 */
     display: flex;
     align-items: center;
     justify-content: center;
     font-size: 14px;
     font-weight: 700;
     color: {{ section.settings.accent_color }};
  }

  #shopify-section-{{ section.id }} .author-name {
    font-weight: 700;
    font-size: 14px; /* text-sm */
    color: {{ section.settings.text_color }};
    display: block;
    margin: 0 0 2px 0;
  }

  #shopify-section-{{ section.id }} .verified-badge {
    font-size: 12px; /* text-xs */
    color: rgba(26, 26, 26, 0.6);
    display: flex;
    align-items: center;
    gap: 4px;
  }

  #shopify-section-{{ section.id }} .verified-icon {
      color: #16a34a; /* text-green-600 */
      width: 14px;
      height: 14px;
      fill: currentColor;
  }
{%- endstyle -%}

<div class="community-section">
  <div class="community-container">
    <div class="section-header">
      {%- if section.settings.eyebrow != blank -%}
        <span class="eyebrow">{{ section.settings.eyebrow | escape }}</span>
      {%- endif -%}

      {%- if section.settings.title != blank -%}
        <h2 class="main-title">{{ section.settings.title | escape }}</h2>
      {%- endif -%}

      <div class="rating-block">
        <div class="stars">
          <!-- 5 Stars SVG -->
          {% for i in (1..5) %}
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256">
              <path d="M234.5,114.38l-45.1,39.36,13.51,58.6a16,16,0,0,1-23.84,17.34l-51.11-31-51,31a16,16,0,0,1-23.84-17.34L66.61,153.8,21.5,114.38a16,16,0,0,1,9.11-28.06l59.46-5.15,23.21-55.36a15.95,15.95,0,0,1,29.44,0h0L166,81.17l59.44,5.15a16,16,0,0,1,9.11,28.06Z"></path>
            </svg>
          {% endfor %}
        </div>
        {%- if section.settings.rating_text != blank -%}
          <span class="rating-text">{{ section.settings.rating_text | escape }}</span>
        {%- endif -%}
      </div>
    </div>

    <div class="reviews-grid">
      {%- for block in section.blocks -%}
        <div class="review-card" {{ block.shopify_attributes }}>
          <div class="card-stars">
            {% for i in (1..5) %}
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256">
                <path d="M234.5,114.38l-45.1,39.36,13.51,58.6a16,16,0,0,1-23.84,17.34l-51.11-31-51,31a16,16,0,0,1-23.84-17.34L66.61,153.8,21.5,114.38a16,16,0,0,1,9.11-28.06l59.46-5.15,23.21-55.36a15.95,15.95,0,0,1,29.44,0h0L166,81.17l59.44,5.15a16,16,0,0,1,9.11,28.06Z"></path>
              </svg>
            {% endfor %}
          </div>

          {%- if block.settings.review_title != blank -%}
            <h3 class="review-title">{{ block.settings.review_title | escape }}</h3>
          {%- endif -%}

          <p class="review-text">{{ block.settings.quote | escape }}</p>

          <div class="author-block">
            {%- if block.settings.author_image != blank -%}
              <img
                src="{{ block.settings.author_image | image_url: width: 80 }}"
                alt="{{ block.settings.author }}"
                class="author-img"
                loading="lazy"
                width="40"
                height="40"
              >
            {%- else -%}
              <div class="author-placeholder">
                {%- assign author_parts = block.settings.author | split: ' ' -%}
                {%- if author_parts.size > 1 -%}
                  {{ author_parts[0] | slice: 0 | upcase -}}
                  {{- author_parts[1] | slice: 0 | upcase }}
                {%- else -%}
                  {{ block.settings.author | slice: 0, 2 | upcase }}
                {%- endif -%}
              </div>
            {%- endif -%}

            <div>
              <span class="author-name">{{ block.settings.author | escape }}</span>
              {%- if block.settings.verified -%}
                <span class="verified-badge">
                  <svg class="verified-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256">
                    <path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm45.66,85.66-56,56a8,8,0,0,1-11.32,0l-24-24a8,8,0,0,1,11.32-11.32L112,148.69l50.34-50.35a8,8,0,0,1,11.32,11.32Z"></path>
                  </svg>
                  Verified Buyer
                </span>
              {%- endif -%}
            </div>
          </div>
        </div>
      {%- endfor -%}
    </div>
  </div>
</div>
